
//
// Copyright (c) 1992-2024 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ideafarm.home.1 for permitted uses.
//
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 33 years.
// Respecting the rights of other people is an important part of empowering one another.
//


}
    *(flagsT*)&flagsCt |= flBOOKc_FILEiScONSTRUCTED ;

    THREADmODE3rESTORE
    new( 0 , tinBaseP , pbFile , sizeof pbFile ) fileC( tinBaseP , ostoName , access , share , flagsDetails , how , flFILEaTTR1_null , flFILEaTTR2_null , F(flagsCt) & flBOOKc_DELETE ? flFILEc_DELETE : flFILEc_null ) ;
    THREADmODE3oN( flTHREADmODE3_DISALLOWpUSE )

    /*if( F(flagsCt) & ( flBOOKc_DOnOTuSEpUSE | flBOOKc_DOnOTrEGISTERfILE ) )*/ flagsDetails |= flOPENdETAILS_DOnOTrEGISTER ;    
    flagsT flagsDetails = flOPENdETAILS_DOnOTvALIDATE | flOPENdETAILS_LOCsEQ | flOPENdETAILS_NOcACHE ;
    countT how          = F(flagsCt) & flBOOKc_WRITER ? ifcOPENhOW_nCeO : ifcOPENhOW_nFeO ;
    countT share        = ifcOPENsHARE_WR ;
    countT access       = ifcOPENaCCESS_WR ; //CANNOT SPECIFY READ ONLY HERE BECAUSE napkinC MIGHT NEED TO FORMAT ITSELF EVEN IF I AM ONLY GOING TO READ THE DATA SECTION OF THE NAPKIN

    //}
    //    OStEXTA( ostoName , osName ) ;
    //
    //    ether.delF( tinBaseP , psttm ) ;
    //    osFileNameC osName( tinBaseP , ether , T(psttm) ) ;
    //    ether.diskMapFileNameF( tinBaseP , psttm , tName ) ; ___( psttm ) ;
    //    ZE( strokeS* , psttm ) ;
    //    etherC& ether = *((tinNormalS&)tinBaseP).pEther ;
    //
    //    ctFileNameIF( tinBaseP , tName , postShortP , postPathP , idStateSpaceP , idMemorySpaceP , flagsCt ) ;
    //    TN( tName , "" ) ;
    //{
    //else
    //20171113@0847: TO ELIMINATE NONMONOTONIC GRABBING, ELIMINATE ALL USE OF poolC BY booksC bookC
    }
        }
            ((tinNormalS&)tinBaseP).pEther->diskMakeDirIfNeededF( tinBaseP , T(iffn) ) ;  //DO THIS ONLY IF EXPLICIT PATH, WHICH SHOULD AVOID NONMONOTONIC GRABBING SINCE IT WILL AVOID bksTelemetry AND bksTrace* booksC FILES
            ifFileNameC iffn( tinBaseP , *((tinNormalS&)tinBaseP).pEther , ostoName ) ;

            OStEXTAK( ostoName , ".bookC" ) ;
            OStEXTA(  ostoName , postShortP ) ;
            }
                OStEXTAK( ostoName , "." ) ;
                OStEXTCF( ostoName , idStateSpaceP , '0' ) ;
                OStEXTAK( ostoName , "." ) ;
                OStEXTCF( ostoName , idMemorySpaceP ? idMemorySpaceP : ((tinNormalS&)tinBaseP).pag1->idMemorySpace , '0' ) ;
                OStEXTAK( ostoName , "." ) ;
                OStEXTA(  ostoName , thirdC::postUserNameIF() ) ;
            {
            if( !( F(flagsCt) & flBOOKc_NOsHORTfILENAMEpREFIX ) )
            OStEXTA(  ostoName , postPathP ) ;

            if( POOP ) { BLAMMO ; }

            SCOOP
            poopC poop ;
        {
        else
        }
            OStEXTAK( ostoName , ".bookC" ) ;
            OStEXTA(  ostoName , postShortP ) ;
            OStEXTAK( ostoName , "\\" ) ;
            OStEXTCF( ostoName , idStateSpaceP , '0' ) ;                                                            thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\" ) ;
            OStEXTAK( ostoName , "\\stateSpaces" ) ;                                                                thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTCF( ostoName , idMemorySpaceP ? idMemorySpaceP : ((tinNormalS&)tinBaseP).pag1->idMemorySpace , '0' ) ;               thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\" ) ;
            OStEXTA(  ostoName , thirdC::postUserNameIF() ) ;                                                       thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\" ) ;
            OStEXTAK( ostoName , "\\memorySpaces" ) ;                                                               thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\ipdos" ) ;                                                                      thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\ideafarm" ) ;                                                                   thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\com" ) ;                                                                        thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\domains" ) ;                                                                    thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\backed.up.daily" ) ;                                                            thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTAK( ostoName , "\\ephemeral" ) ;                                                                  thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;
            OStEXTA(  ostoName , postHome ) ;                                                                       thirdC::dosCreateDirIF( tinBaseP , ostoName ) ;

            if( POOP ) { BLAMMO ; }
            thirdC::diskFindHomeIF( tinBaseP , postHome , sizeof postHome , "ideafarm" ) ;
            osTextT postHome[ TUCK << 1 ] ;

            SCOOP
            poopC poop ;
        {
        if( !postPathP )
        //CS:CODEsYNC: 350fa004 360fa005 360fb012
    {
    //if( F(flagsCt) & ( flBOOKc_DOnOTuSEpUSE ) )
    OStEXT( ostoName , TUCK << 2 )

    _IO_

    }
        if( POOP ) return ;
        __( idMemorySpaceP && !( F(((tinNormalS&)tinBaseP).flagsThreadMode4) & flTHREADmODE4_ALLOWeXPLICITmEMORYsPACE ) && thirdC::third_idPhaseAdam_IF( tinBaseP ) >= ifcIDpHASEaDAM_EXEpROLOGaDAMmAIN1 && thirdC::third_idPhaseAdam_IF( tinBaseP ) < ifcIDpHASEaDAM_EXEePILOGaDAMmAINa1 ) ;
        __Z( idStateSpaceP ) ;
        __Z( postShortP ) ;
        if( POOP ) return ;
    {
    IFbEcAREFUL    

    //if( !idMemorySpaceP ) idMemorySpaceP = ((tinNormalS&)tinBaseP).pag1->idMemorySpace ;
    //20200417@1855: KEEP idMemorySpaceP NULL SO THAT CALLER DOES NOT HAVE TO SET flTHREADmODE4_ALLOWeXPLICITmEMORYsPACE
{
/*1*/voidT bookC::ctFileF( tinBaseS& tinBaseP , const osTextT* const postShortP , const osTextT* const postPathP , const countT idStateSpaceP , countT idMemorySpaceP )/*1*/

/**/
*/
/*

//
// Respecting the rights of other people is an important part of empowering one another.
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 33 years.
//
// Copyright (c) 1992-2024 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ideafarm.home.1 for permitted uses.
//

