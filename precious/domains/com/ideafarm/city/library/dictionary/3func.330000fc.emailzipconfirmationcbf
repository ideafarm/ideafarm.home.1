
//
// Copyright (c) 1992-2024 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ideafarm.home.1 for permitted uses.
//
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 33 years.
// Respecting the rights of other people is an important part of empowering one another.
//


}
    //etThread.traceF( tin0P , T("postBodyP:  ")+T(postBodyP) ) ;
    //etThread.traceF( tin0P , T("psttPeerAgentP:  ")+T(psttPeerAgentP) ) ;
    //etThread.traceF( tin0P , T("psttUrlP:  ")+T(psttUrlP) ) ;
    //etThread.traceF( tin0P , T("nnPeerP: ")+T(nnPeerP) ) ;

    swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP.ungrabF( tin0P ) ;

    else meP.pushSnipF( tin0P , stBodyP , T("I did not recognize the password in the link that you clicked.  (This will happen if the server serving you this page was restarted.)  Please submit your email and postal code again.\r\n\r\nIf you receive this error more than once, request support by emailing support@ideafarm.com .\r\n") ) ;
    }
        swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP.purgeF( tin0P ) ;

        else meP.pushSnipF( tin0P , stBodyP , T("Something went wrong.  I recognized your password but could not find your email and postal code.  Please register your email again.\r\n") ) ;
        }
            THREADmODE2rESTORE

            etThread.delF( tin0P , psttCountry ) ;
            etThread.delF( tin0P , psttZip     ) ;
            etThread.delF( tin0P , psttEmail   ) ;
            etThread.delF( tin0P , psttDelete  ) ;
            etThread.delF( tin0P , psttPeer    ) ;

            etThread.boxPutF( tin0P , T("smtp.mailgun.org[admin]/b42/smtp/")+tHost+T("@ideafarm.com/")+T(psttEmail)+T("//wo@ideafarm.com/ideafarm.factory.reports@gmail.com") , tBody ) ;

            tBody += T("time:  ")+tTime+T("\r\n") ;
            tBody += T("\r\nreference:  ")+tShort+T("\r\n") ;

            }
                tBody += T("country:  ")+T(psttCountry)+T("\r\n") ;
                tBody += T("postal code:  ")+T(psttZip)+T("\r\n") ;
            {
            if( !bDelete )

            tBody += T("email:  ")+T(psttEmail)+T("\r\n") ;

            ) ;

                    "\r\n"
                    "The following information has been registered:\r\n"
                    "Thank you for deciding to participate in Wo'O's Table.\r\n"
                    "\r\n"
                    "Subject: Wo'O's Table:  Your email is now registered.\r\n"
                :    
                    "\r\n"
                    "Sorry to see you go!  If you change your mind, just register again.\r\n"
                    "\r\n"
                    "Subject: Wo'O's Table:  Your email has been unregistered, effective immediately.\r\n"
                ?
                bDelete

            TN( tBody ,

            textC tTime( ifcIDtEXTgEN_TIMEnOWfOREIGN , tin0P , TAG( TAGiDnULL ) ) ;

            }
                etThread.delF( tin0P , psttFile ) ;
                etThread.delF( tin0P , psttShort ) ;
                etThread.delF( tin0P , psttnu ) ;
                tShort = T(psttShort) ;
                etThread.strBisectF( tin0P , psttnu , psttShort , psttFile , T("/") , - 1 , flSTRbISECT_APPENDdELIMITER ) ; ___( psttnu ) ; ___( psttShort ) ;
                ZE( strokeS* , psttShort ) ;
                ZE( strokeS* , psttnu ) ;

                etThread.boxPutUniqueF( tin0P , psttFile , T("///ideafarm/ephemeral/backed.up.daily/domains/com/ideafarm/wo.o.s.table/confirmed.email/email.")+tHost , WS( rec ) ) ; ___( psttFile ) ;
                ZE( strokeS* , psttFile ) ;
            {
            TN( tShort , "" ) ;

            }
                if( !tHost.csF( tin0P ) ) tHost = T("factories") ;
                etThread.delF( tin0P , psttHost ) ;
                else            tHost = T(psttHost) ;
                if( !psttHost ) etThread.traceF( tin0P , T("error: reverse DNS lookup on myself failed 82") ) ;
                etThread.sockPsttHostF( tin0P , psttHost ) ; ___( psttHost ) ;
                ZE( strokeS* , psttHost ) ;
            {
            TN( tHost , "" ) ;

            THREADmODE2oN( flTHREADmODE2_ALLOWsTOPwHILEgRABBING )

            rec << psttCountry ;
            rec << psttZip ;
            rec << psttEmail ;
            rec << psttDelete ;
            rec << psttPeer ;
            rec << (countT)1 ;          // IDfORMAT
            rec << finger ;
            soulC rec( tin0P , TAG( TAGiDnULL ) ) ;

            putNegAM( *(countT*)&finger , FINGERnEG_WOtABLEcONFIRMEDeMAIL ) ;
            ZE( countT , finger ) ;

            else          meP.pushSnipF( tin0P , stBodyP , T(psttEmail)+T(" is now registered for Wo'O's Table in ")+T(psttZip)+T(".  Come.  Eat with us!<p>To update (or delete), simply register again.\r\n") ) ;
            if( bDelete ) meP.pushSnipF( tin0P , stBodyP , T(psttEmail)+T(", has been unregistered, effective immediately.  Sorry to see you go!  (If you change your mind, just register again.)\r\n") ) ;
            boolT bDelete = psttDelete && !etThread.strCompareF( tin0P , psttDelete , T("yes") ) ;

            }
                if( POOP ) { POOPR ; }

                THREADmODE2rESTORE
                ((tin9S&)tin0P).pEtScratch->boxZapF( tin0P , T("///ideafarm/ephemeral/backed.up.daily/domains/com/ideafarm/wo.o.s.table/unconfirmed.email/ip.")+T(psttPeer) , 1 ) ;
                THREADmODE2oN( flTHREADmODE2_ALLOWsTOPwHILEgRABBING )

                SCOOPS
            {
            IFsCRATCH

            swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP >> psttPeer    ;
            swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP >> psttDelete  ;
            swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP >> psttEmail   ;
            swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP >> psttZip     ;
            swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP >> psttCountry ;
            ZE( strokeS* , psttCountry ) ;
            ZE( strokeS* , psttZip     ) ;
            ZE( strokeS* , psttEmail   ) ;
            ZE( strokeS* , psttDelete  ) ;
            ZE( strokeS* , psttPeer    ) ;
        {
        if( swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP == 5 )

        cLeverPasswordP = password ;
    {
    if( swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP.idSlotOfLeverF( tin0P , password ) )

    swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP.grabF( tin0P , TAG( TAGiDnULL ) ) ;

    countT password = etThread.strDigitsToSCountF( tin0P , tPass ) ;

    swKVP.ungrabF( tin0P ) ;
    psttLeverKVP = tKeyPass ; tPass = T((strokeS*)(countT)swKVP) ;
    swKVP.grabF( tin0P , TAG( TAGiDnULL ) ) ;
    TN( tPass , "" ) ;

    TN( tKeyPass , "pass" ) ;

    //swKVP.ungrabF( tin0P ) ;
    //}
    //    etThread.traceF( tin0P           , T("KV:  ")+T(psttLeverKVP)+T(":  \"")+T(psttv)+T("\"") ) ;
    //
    //    strokeS* psttv = (strokeS*)(countT)swKVP ;
    //    psttLeverKVP = (strokeS*)swKVP.leverF( tin0P , idf ) ;
    //{
    //for( countT idf = 1 ; idf <= cFlavors ; idf ++ )
    //etThread.traceF(   tin0P , TF2(cFlavors,flFORMAT_NObIGITvALUES|flFORMAT_UNSIGNED)+T(" KV's received:") ) ;
    //countT cFlavors = swKVP.cFlavorsF( tin0P ) ;
    //swKVP.grabF( tin0P , TAG( TAGiDnULL ) ) ;

    switchStackC& swsUnconfirmedPeerDeleteEmailZipCountryByPasswordP = *(switchStackC*)c8pP.c4 ;
    countT&       cLeverPasswordP                                    =       *(countT*)c8pP.c3 ;
    count8S&      c8pP                                               =        *(count8S*)cArgP ;
{
/*1*/voidT emailZipConfirmationCBF( tin0S& tin0P , etherC& etThread , const boolT& bQuitP , httpServerC& meP , countT& cArgP , httpReplyS& replyP , stackC& stBodyP , const strokeS* const psttKVReportP , switchC& swKVP , strokeS*& psttLeverKVP , sessionsC& sessionsP , nicNameC& nnPeerP , const strokeS* const psttNameP , const strokeS* const psttQueryKVP , const strokeS* const psttPeerAgentP , const osTextT* const postBodyP )/*1*/

/**/
*/
/*

//
// Respecting the rights of other people is an important part of empowering one another.
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 33 years.
//
// Copyright (c) 1992-2024 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ideafarm.home.1 for permitted uses.
//

